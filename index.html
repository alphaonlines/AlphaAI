<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Tech Timeline | -3500 - 2026</title>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@700&display=swap');

    :root {
      /* Premium dark theme variables */
      --bg: #0a0b0e;
      --bg-alt: linear-gradient(135deg, #0a0b0e 0%, #1a1d23 100%);
      --panel: rgba(26, 29, 35, 0.95);
      --panel-strong: rgba(40, 44, 52, 1);
      --text: #e8eaed;
      --muted: #9aa0a6;
      --accent: #4f9cff;
      --accent-2: #00d4aa;
      --accent-3: #ff6b9d;
      --border: rgba(255, 255, 255, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      --forecast: #ffb347;
    }

    body.light-theme {
      --bg: #f8f9fa;
      --bg-alt: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      --panel: rgba(255, 255, 255, 0.95);
      --panel-strong: #ffffff;
      --text: #1a1a1a;
      --muted: #5f6368;
      --accent: #0066cc;
      --accent-2: #00a86b;
      --accent-3: #e63946;
      --border: rgba(0, 0, 0, 0.15);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    /* Base Layout */
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh;
      background: var(--bg-alt); color: var(--text);
      font-family: 'Inter', system-ui, sans-serif;
      font-size: 16px; line-height: 1.6;
      padding-bottom: 250px; /* Space for mobile bottom drawer */
      transition: background 0.3s ease;
    }
    
    h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; margin: 0; line-height: 1.2; }
    a { color: var(--accent); text-decoration: none; font-weight: 600; }
    
    /* Header */
    header {
      position: sticky; top: 0; z-index: 50;
      background: rgba(26, 29, 35, 0.9); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
    }
    body.light-theme header { background: rgba(255, 255, 255, 0.9); }

    .nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
    .brand { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .brand .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 10px var(--accent); }

    .last-updated {
      font-size: 0.75rem; color: var(--accent-2);
      border: 1px solid var(--border); padding: 4px 8px; border-radius: 6px;
      background: rgba(0, 212, 170, 0.1);
      margin-left: 8px;
    }

    /* Search Bar */
    .search-wrapper {
      display: flex; align-items: center; gap: 8px;
      background: rgba(0,0,0,0.2); padding: 4px 8px;
      border-radius: 50px; border: 1px solid var(--border);
    }
    .search-input {
      background: transparent; border: none; color: var(--text);
      font-family: 'Inter', sans-serif; width: 120px; outline: none; font-size: 14px;
    }
    .search-btn {
      background: var(--accent); color: white; border: none;
      border-radius: 50%; width: 28px; height: 28px;
      display: grid; place-items: center; cursor: pointer;
    }

    /* MAIN LAYOUT GRID */
    .container {
      width: min(1180px, 96vw); margin: 0 auto; padding: 20px;
      display: grid;
      grid-template-columns: minmax(0, 1.35fr) minmax(320px, 0.95fr); /* Timeline | Sticky Sidebar */
      gap: 28px;
    }
    
    /* Hero Section (Spans full width) */
    .hero { grid-column: 1 / -1; text-align: center; margin: 40px 0 20px; }
    .pill { background: var(--panel-strong); padding: 6px 14px; border-radius: 999px; font-size: 0.85rem; color: var(--muted); border: 1px solid var(--border); display: inline-block; margin-bottom: 12px;}
    .hero-actions { display: flex; justify-content: center; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    .cta-btn {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
      color: #fff; border: none; border-radius: 999px; padding: 12px 18px;
      font-weight: 700; cursor: pointer; box-shadow: var(--shadow);
      letter-spacing: 0.01em; transition: var(--transition);
    }
    .cta-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.35); }
    .cta-btn:active { transform: translateY(0); box-shadow: var(--shadow); }

    /* TIMELINE COLUMN */
    .timeline-column { position: relative; }

    /* The Center Spine (Centered within the Left Column) */
    .timeline-feed { position: relative; padding: 20px 0; }
    
    .timeline-feed::before {
      content: ''; position: absolute; top: 0; bottom: 0; left: 50%;
      width: 2px; background: linear-gradient(180deg, var(--accent) 0%, rgba(255,255,255,0.05) 100%);
      transform: translateX(-50%);
    }

    .timeline-card {
      position: relative; width: 48%; margin-bottom: 44px;
      background: var(--panel); border: 1px solid var(--border);
      border-radius: 16px; padding: 20px;
      cursor: pointer; transition: var(--transition);
      transform-origin: center;
      opacity: 0.92;
    }

    /* Active State (Triggered by Scroll) */
    .timeline-card.active-card {
      border-color: var(--accent);
      box-shadow: 0 0 25px rgba(79, 156, 255, 0.2);
      background: var(--panel-strong);
      transform: translateY(-2px);
    }

    .timeline-card.selected-badge::before {
      content: 'Selected';
      position: absolute;
      top: 14px; right: 14px;
      background: rgba(79, 156, 255, 0.12);
      color: var(--accent);
      border: 1px solid rgba(79, 156, 255, 0.35);
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.7rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      font-weight: 700;
    }

    .timeline-card.dimmed { opacity: 0.55; filter: saturate(0.8); }
    }

    /* Alternating Sides */
    .timeline-card:nth-child(odd) { margin-left: auto; margin-right: 0; text-align: left; }
    .timeline-card:nth-child(even) { margin-left: 0; margin-right: auto; text-align: right; }

    /* Center Dots */
    .timeline-dot {
      position: absolute; top: 24px; width: 14px; height: 14px;
      border-radius: 50%; background: var(--bg); border: 3px solid var(--accent);
      z-index: 2; transition: var(--transition);
    }
    .timeline-card:nth-child(odd) .timeline-dot { left: -11.5%; } 
    .timeline-card:nth-child(even) .timeline-dot { right: -11.5%; }
    
    /* Adjust dots based on card width/gap calculation approximately */
    @media (min-width: 900px) {
       .timeline-card:nth-child(odd) .timeline-dot { left: calc(-11% - 3px); } 
       .timeline-card:nth-child(even) .timeline-dot { right: calc(-11% - 3px); } 
    }

    /* Connector Lines */
    .timeline-card::after {
      content: ''; position: absolute; top: 31px; height: 1px; width: 11%;
      background: var(--border); opacity: 0.5; z-index: 1;
    }
    .timeline-card:nth-child(odd)::after { left: -11%; }
    .timeline-card:nth-child(even)::after { right: -11%; }

    /* Content Styling */
    .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .timeline-card:nth-child(even) .card-header { flex-direction: row-reverse; }

    .card-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .timeline-card:nth-child(even) .card-meta { justify-content: flex-end; }

    .timeline-year {
      font-weight: 700; color: var(--accent); text-transform: uppercase;
      font-size: 0.85rem; letter-spacing: 1px; flex-shrink: 0;
    }
    .visual-icon { font-size: 1.5rem; }
    
    .analysis-btn {
      font-size: 0.85rem; color: #fff; margin-top: 10px;
      display: inline-flex; align-items: center; gap: 8px;
      font-weight: 700; padding: 8px 14px;
      border-radius: 999px; border: none; cursor: pointer;
      background: linear-gradient(135deg, var(--accent-3) 0%, var(--accent) 100%);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    .analysis-btn:hover { transform: translateY(-1px); }
    .analysis-btn:active { transform: translateY(0); box-shadow: 0 6px 14px rgba(0,0,0,0.35); }

    /* Expanded Content */
    .extended-content {
      max-height: 0; opacity: 0; overflow: hidden;
      transition: var(--transition);
      margin-top: 0; border-top: 1px solid transparent; text-align: left;
    }
    .timeline-card:nth-child(even) .extended-content { text-align: right; }

    .timeline-card.expanded .extended-content {
      max-height: 800px; opacity: 1; margin-top: 16px;
      padding-top: 16px; border-top-color: var(--border);
    }
    .timeline-card.expanded .expand-hint { display: none; }

    /* STICKY SIDEBAR COLUMN */
    .sidebar-column { position: relative; }
    
    .floating-panel {
      position: sticky; top: 100px;
      background: var(--panel-strong);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: var(--shadow);
      text-align: left;
      transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
      opacity: 0; transform: translateY(20px);
    }
    .floating-panel.visible { opacity: 1; transform: translateY(0); }


    
    .fp-emoji {
      font-size: 2.5rem; margin: 0 0 16px 0;
    }

    .fp-stock-box {
      background: rgba(0, 212, 170, 0.08);
      border: 1px solid var(--accent-2);
      border-radius: 12px; padding: 12px;
      margin-top: 12px; text-align: left;
    }
    .fp-stock-label { font-size: 0.75rem; text-transform: uppercase; color: var(--accent-2); font-weight: 700; display: block; margin-bottom: 4px; }
    .fp-stock-text { font-size: 0.9rem; line-height: 1.4; }

    /* Style for the Wiki Button */
    .wiki-btn {
      display: inline-block; margin-top: 12px;
      padding: 8px 16px; background: var(--accent); color: white;
      border-radius: 6px; font-size: 0.85rem; font-weight: 600;
      transition: opacity 0.2s;
    }
    .wiki-btn:hover { opacity: 0.9; }

    /* Style for the Product Tags */
    .product-tag {
      display: inline-block; padding: 4px 8px;
      background: rgba(255,255,255,0.1); border-radius: 4px;
      font-size: 0.75rem; margin-right: 6px; margin-top: 6px;
      border: 1px solid var(--border);
    }

    .forecast-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(255, 179, 71, 0.14);
      border: 1px solid rgba(255, 179, 71, 0.4);
      color: var(--forecast);
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .forecast-note {
      margin: 12px 0 0;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255, 179, 71, 0.12);
      border: 1px solid rgba(255, 179, 71, 0.35);
      color: var(--forecast);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* MOBILE RESPONSIVE */
    @media (max-width: 900px) {
      .container { grid-template-columns: 1fr; gap: 0; padding: 10px; }
      
      /* Sidebar becomes Bottom Drawer */
      .sidebar-column {
        position: fixed; bottom: 0; left: 0; right: 0;
        z-index: 100; pointer-events: none;
        padding: 10px;
      }
      .floating-panel {
        pointer-events: auto;
        text-align: left; padding: 12px;
        background: rgba(26, 29, 35, 0.98);
        border: 1px solid var(--accent);
        box-shadow: 0 -4px 30px rgba(0,0,0,0.5);
        margin: 0; top: auto;
        max-height: 65vh;
        overflow-y: auto;
        transform: translateY(0);
      }
      .floating-panel.collapsed {
        transform: translateY(calc(100% - 56px));
        box-shadow: 0 -2px 18px rgba(0,0,0,0.35);
        border-color: var(--border);
      }
      .drawer-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 10px 12px;
        margin: -12px -12px 12px -12px;
        background: rgba(255,255,255,0.04);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 2;
      }
      .drawer-toggle button {
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 999px;
        padding: 6px 12px;
        font-weight: 700;
        cursor: pointer;
      }
      .drawer-label {
        font-weight: 700;
        letter-spacing: 0.02em;
      }
      .fp-stock-box { background: transparent; border: none; padding: 0; margin: 0; }
      .fp-stock-label { display: inline; margin-right: 6px; }
      .fp-stock-text { font-size: 0.85rem; display: inline; }

      /* Timeline Adjustments */
      .timeline-feed::before { left: 20px; transform: none; }
      .timeline-card { 
        width: calc(100% - 50px); 
        margin-left: 50px !important; margin-right: 0 !important; 
        text-align: left !important;
      }
      .timeline-card:nth-child(even) .card-header { flex-direction: row; }
      .timeline-card:nth-child(even) .extended-content { text-align: left; }
      
      .timeline-dot { left: -38px !important; right: auto !important; }
      .timeline-card::after { left: -30px !important; right: auto !important; width: 30px; }
    }
  </style>
</head>
<body>

  <header>
    <div class="nav">
      <div class="brand">
        <span class="dot"></span>
        <span id="titleText">AlphaAI v2.5 Timeline</span>
        <span class="last-updated" id="lastUpdatedDate">Updated: Today</span>
      </div>
      
       <div class="search-wrapper">
         <input type="text" class="search-input" placeholder="Search timeline...">
         <button class="search-btn" onclick="playHistory()">â–¶</button>
       </div>
    </div>
  </header>

  <div class="container">
    <section class="hero">
      <div class="pill">-3500 â€“ 2026</div>
      <h1>Innovation Timeline</h1>
      <p style="color: var(--muted); margin-top: 8px;">
        From the Voltaic Pile to Agentic AI.
      </p>
      <div class="hero-actions">
        <button type="button" class="cta-btn" onclick="scrollToBeginning()">Start from the beginning</button>
      </div>
    </section>

    <div class="timeline-column">
      <div class="timeline-feed" id="timelineFeed">
        </div>
    </div>

    <div class="sidebar-column">
      <aside class="floating-panel" id="floatingPanel">
        <div class="drawer-toggle" id="drawerToggle">
          <span class="drawer-label">Milestone details</span>
          <button type="button" id="drawerToggleBtn">Expand</button>
        </div>
        <div class="fp-content">
          <div class="fp-emoji" id="fpEmoji">ðŸš€</div>
          <h3 id="fpTitle" style="font-size: 1.4rem; margin-bottom: 8px;">Select an Era</h3>
          <p id="fpSummary" style="color: var(--muted); font-size: 0.95rem; margin-bottom: 16px;">
            Scroll through history to see market impacts.
          </p>
          <div id="fpForecast" class="forecast-note" style="display:none;">Forecast / speculative entry. Details may evolve.</div>

          <div class="fp-stock-box">
            <span class="fp-stock-label">ðŸ“ˆ Market Analysis</span>
            <span class="fp-stock-text" id="fpStock">Waiting for data...</span>
          </div>

          <div id="fpProducts" style="margin-top: 16px;"></div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Sticky sidebar element references
    const floatingPanel = document.getElementById('floatingPanel');
    const fpTitle = document.getElementById('fpTitle');
    const fpStock = document.getElementById('fpStock');
    const fpEmoji = document.getElementById('fpEmoji');
    const fpSummary = document.getElementById('fpSummary');
    const fpProducts = document.getElementById('fpProducts');
    const drawerToggle = document.getElementById('drawerToggle');
    const drawerToggleBtn = document.getElementById('drawerToggleBtn');
    let drawerOpen = false;

    const isMobileLayout = () => window.matchMedia('(max-width: 900px)').matches;

    function collapseDrawer() {
      if (!isMobileLayout()) return;
      floatingPanel.classList.add('collapsed');
      drawerOpen = false;
      drawerToggleBtn.textContent = 'Expand';
    }

    function expandDrawer() {
      if (!isMobileLayout()) return;
      floatingPanel.classList.remove('collapsed');
      drawerOpen = true;
      drawerToggleBtn.textContent = 'Hide';
    }

    function populateFloatingPanel(data = {}) {
      floatingPanel.classList.add('visible');

      fpTitle.textContent = data.title || 'Select an Era';
      fpEmoji.textContent = data.visual || 'ðŸ›°ï¸';

      fpStock.textContent = data.market_analysis || data.stockReaction || data.summary || 'Waiting for data...';
      fpSummary.textContent = data.summary || 'Scroll through history to see market impacts.';

      const forecastBanner = document.getElementById('fpForecast');
      if (data.isForecast) {
        forecastBanner.style.display = 'block';
      } else {
        forecastBanner.style.display = 'none';
      }

      fpProducts.innerHTML = '';
      if (data.products && Array.isArray(data.products)) {
        data.products.forEach(prod => {
          const tag = document.createElement('span');
          tag.className = 'product-tag';
          tag.textContent = prod;
          fpProducts.appendChild(tag);
        });
      }
    }

    function setActiveCard(card) {
      if (!card) return;

      document.querySelectorAll('.timeline-card').forEach(c => {
        c.classList.remove('active-card', 'selected-badge');
        c.classList.add('dimmed');
      });
      card.classList.add('active-card', 'selected-badge');
      card.classList.remove('dimmed');

      const data = JSON.parse(card.dataset.info || '{}');
      populateFloatingPanel(data);
    }

    function toggleCardExpansion(card) {
      const isExpanded = card.classList.contains('expanded');
      document.querySelectorAll('.timeline-card').forEach(c => c.classList.remove('expanded'));
      if(!isExpanded) card.classList.add('expanded');
    }

    // Drawer interactions for mobile
    drawerToggle.addEventListener('click', (e) => {
      if (!isMobileLayout()) return;
      e.stopPropagation();
      drawerOpen ? collapseDrawer() : expandDrawer();
    });

    window.addEventListener('resize', () => {
      if (isMobileLayout()) {
        collapseDrawer();
      } else {
        floatingPanel.classList.remove('collapsed');
        drawerToggleBtn.textContent = 'Hide';
        drawerOpen = true;
      }
    });

    window.addEventListener('scroll', () => {
      if (isMobileLayout() && drawerOpen) {
        collapseDrawer();
      }
    }, { passive: true });

    // --- CONFIGURATION ---
    const lastUpdated = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    document.getElementById('lastUpdatedDate').textContent = `Updated: ${lastUpdated}`;
    const currentYear = new Date().getFullYear();

    // --- SEARCH FUNCTIONALITY ---
    const searchInput = document.querySelector('.search-input');
    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      const cards = document.querySelectorAll('.timeline-card');

      cards.forEach(card => {
        // Search in title, summary, and year
        const info = JSON.parse(card.dataset.info);
        const textContent = `${info.title} ${info.summary} ${info.year}`.toLowerCase();

        if (textContent.includes(term)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });

    // --- FETCH DATA & INIT ---
    const monthOrder = {
      'jan': 1, 'feb': 2, 'mar': 3, 'apr': 4, 'may': 5, 'jun': 6,
      'jul': 7, 'aug': 8, 'sep': 9, 'oct': 10, 'nov': 11, 'dec': 12,
      'early': 3, 'mid': 6, 'late': 9
    };

    function sortTimeline(data) {
      return data.slice().sort((a, b) => {
        if (b.year !== a.year) return b.year - a.year;
        const aMonth = monthOrder[(a.month || '').toLowerCase()] || 0;
        const bMonth = monthOrder[(b.month || '').toLowerCase()] || 0;
        return bMonth - aMonth;
      });
    }

    async function initTimeline() {
      const errors = [];
      const datasets = [];

      const sources = [
        {
          name: 'local',
          url: new URL('timeline.json', window.location.href).href,
          options: { cache: 'no-store', mode: 'same-origin' },
        },
        {
          name: 'remote',
          url: 'https://raw.githubusercontent.com/alphaonlines/AlphaAI/main/timeline.json',
          options: { cache: 'no-store' },
        }
      ];

      for (const source of sources) {
        try {
          const response = await fetch(source.url, source.options);
          if (!response.ok) throw new Error(`${source.name} responded ${response.status}`);
          const json = await response.json();
          datasets.push(json);
        } catch (err) {
          const message = `${source.name} timeline failed: ${err.message}`;
          console.warn(message);
          errors.push(message);
        }
      });

      const mergedTimeline = sortTimeline(Array.from(mergedMap.values()));

      if (mergedTimeline.length === 0) {
        document.getElementById('timelineFeed').innerHTML =
          '<div style="text-align:center; padding:40px;"><h3>Unable to load data.</h3><p>Ensure timeline.json exists locally or check internet connection.</p></div>';
        return;
      }

      const mergedMap = new Map();

      datasets.flat().forEach(item => {
        const key = `${item.year}-${item.title}`;
        if (!mergedMap.has(key)) {
          mergedMap.set(key, item);
        }
      });

      const mergedTimeline = sortTimeline(Array.from(mergedMap.values()));

      if (mergedTimeline.length === 0) {
        document.getElementById('timelineFeed').innerHTML =
          `<div style="text-align:center; padding:40px;">
            <h3>Unable to load data.</h3>
            <p>Make sure <code>timeline.json</code> is served from this directory or that the internet connection is available.</p>
            ${errors.length ? `<p style="color:var(--muted); font-size:0.9rem;">${errors.join('<br>')}</p>` : ''}
          </div>`;
        return;
      }

      renderTimeline(mergedTimeline);
    }

    // --- RENDER TIMELINE (Modified to accept data argument) ---
    function renderTimeline(data) {
      const container = document.getElementById('timelineFeed');
      container.innerHTML = ''; // Clear loading state

      data.forEach((item, index) => {
        const isForecast = Number(item.year) > currentYear;
        const cardPayload = { ...item, isForecast };
        const card = document.createElement('article');
        card.className = 'timeline-card';
        card.id = `card-${item.year}`;
        card.dataset.year = item.year;
        card.dataset.index = index;

        // Note: We use JSON.stringify for data passing to keep the logic clean
        card.dataset.info = JSON.stringify(cardPayload);

        card.innerHTML = `
          <div class=\"timeline-dot\"></div>
          <div class=\"card-header\">
            <span class=\"visual-icon\">${item.visual}</span>
            <div>
              <div class=\"card-meta\">
                <span class=\"timeline-year\">${item.month ? item.month + ' ' : ''}${item.year}</span>
                ${isForecast ? '<span class=\"forecast-pill\">Forecast</span>' : ''}
              </div>
              <h3 style=\"font-size:1.1rem;\">${item.title}</h3>
            </div>
          </div>

          <p>${item.summary}</p>
          <button type=\"button\" class=\"analysis-btn\">ðŸ“Š View market analysis</button>

          <div class=\"extended-content\">
            <div style=\"padding-left:12px; border-left:2px solid var(--accent); margin-bottom:12px; color: var(--text);\">
              <strong>Why it matters:</strong> ${item.why || \"Historical significance.\"}
            </div>

            ${item.wiki_url ? `<a href=\"${item.wiki_url}\" target=\"_blank\" class=\"wiki-btn\">ðŸ“– Read on Wikipedia</a>` : ''}
          </div>
        `;

        // Click to toggle expansion
        card.addEventListener('click', (e) => {
          if(e.target.tagName === 'A' || e.target.closest('.analysis-btn')) return;
          setActiveCard(card);
          toggleCardExpansion(card);
        });

        const analysisButton = card.querySelector('.analysis-btn');
        analysisButton.addEventListener('click', (event) => {
          event.stopPropagation();
          setActiveCard(card);
          toggleCardExpansion(card);
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        container.appendChild(card);
      });

      setupObserver(data);

      // NEW: Auto-select the first card to populate the sidebar immediately
      if (document.querySelector('.timeline-card')) {
          setActiveCard(document.querySelector('.timeline-card'));
      }
    }

    // --- STICKY PANEL LOGIC (Modified to read from dataset) ---
    function setupObserver(timelineData) {
      const cards = document.querySelectorAll('.timeline-card');

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            setActiveCard(entry.target);
          }
        });
      }, {
        threshold: 0.5,
        rootMargin: "-10% 0px -10% 0px"
      });

      cards.forEach(card => observer.observe(card));
    }

    // --- JUMP TO YEAR ---
    function jumpToYear() {
      const input = document.getElementById('yearInput').value;
      if (!input) return;
      const targetYear = parseInt(input);
      const cards = Array.from(document.querySelectorAll('.timeline-card'));
      
      const targetCard = cards.reduce((prev, curr) => {
        return (Math.abs(curr.dataset.year - targetYear) < Math.abs(prev.dataset.year - targetYear) ? curr : prev);
      });

      if (targetCard) {
        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        targetCard.click(); 
        targetCard.style.transition = '0.2s';
        targetCard.style.background = 'var(--accent)';
        setTimeout(() => {
          targetCard.style.background = '';
          targetCard.style.transition = 'var(--transition)';
        }, 400);
      }
    }

    // --- JUMP TO OLDEST ---
    function scrollToBeginning() {
      const cards = document.querySelectorAll('.timeline-card');
      if (!cards.length) return;

      const oldestCard = cards[cards.length - 1];
      oldestCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      if (!oldestCard.classList.contains('expanded')) {
        oldestCard.click();
      }
      oldestCard.style.transition = '0.3s';
      oldestCard.style.borderColor = 'var(--accent)';
      setTimeout(() => {
        oldestCard.style.borderColor = '';
      }, 1200);
    }

    // --- AUTOMATED TOUR ---
    function playHistory() {
      // 1. Get all timeline cards from the DOM
      const cards = Array.from(document.querySelectorAll('.timeline-card'));
      
      // 2. The DOM is sorted Newest(top) -> Oldest(bottom).
      //    Reverse it to get Chronological order (-3500 -> 2026).
      const chronologicalCards = cards.reverse();

      // 3. Select only the first 10 events
      const tourSteps = chronologicalCards.slice(0, 10);

      // 4. Iterate and schedule the scrolls
      tourSteps.forEach((card, index) => {
        setTimeout(() => {
          // Scroll the card into the center of the view
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Simulate a click to expand the details (optional)
          if (!card.classList.contains('expanded')) {
            card.click();
          }
          
          // Visual feedback: Flash the card using the accent color
          card.style.transition = '0.3s';
          card.style.borderColor = 'var(--accent)';
          card.style.boxShadow = '0 0 20px var(--accent)';
          
          // Remove the highlight after 1.5 seconds
          setTimeout(() => {
            card.style.borderColor = '';
            card.style.boxShadow = '';
          }, 1500);

        }, index * 4000); // 4000ms = 4 seconds per event
      });
    }

    // Start
    document.addEventListener('DOMContentLoaded', () => {
      if (isMobileLayout()) {
        collapseDrawer();
      } else {
        drawerOpen = true;
        drawerToggleBtn.textContent = 'Hide';
      }
      initTimeline();
    });
</script>
</body>
</html>
