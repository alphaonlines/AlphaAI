<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AlphaAI v3.2 Timeline | -3500 - 2026</title>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@700&display=swap');

    :root {
      /* Premium dark theme variables */
      --bg: #0a0b0e;
      --bg-alt: linear-gradient(135deg, #0a0b0e 0%, #1a1d23 100%);
      --panel: rgba(26, 29, 35, 0.95);
      --panel-strong: rgba(40, 44, 52, 1);
      --text: #e8eaed;
      --muted: #9aa0a6;
      --accent: #4f9cff;
      --accent-2: #00d4aa;
      --accent-3: #ff6b9d;
      --border: rgba(255, 255, 255, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      --forecast: #ffb347;
    }

    body.light-theme {
      --bg: #f8f9fa;
      --bg-alt: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      --panel: rgba(255, 255, 255, 0.95);
      --panel-strong: #ffffff;
      --text: #1a1a1a;
      --muted: #5f6368;
      --accent: #0066cc;
      --accent-2: #00a86b;
      --accent-3: #e63946;
      --border: rgba(0, 0, 0, 0.15);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    /* Base Layout */
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh;
      background: var(--bg-alt); color: var(--text);
      font-family: 'Inter', system-ui, sans-serif;
      font-size: 16px; line-height: 1.6;
      padding-bottom: 250px; /* Space for mobile bottom drawer */
      transition: background 0.3s ease;
    }
    
    h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; margin: 0; line-height: 1.2; }
    a { color: var(--accent); text-decoration: none; font-weight: 600; }
    
    /* Header */
    header {
      position: sticky; top: 0; z-index: 50;
      background: rgba(26, 29, 35, 0.9); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
    }
    body.light-theme header { background: rgba(255, 255, 255, 0.9); }

    .nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
    .brand { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .brand .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 10px var(--accent); }

    .last-updated {
      font-size: 0.75rem; color: var(--accent-2);
      border: 1px solid var(--border); padding: 4px 8px; border-radius: 6px;
      background: rgba(0, 212, 170, 0.1);
      margin-left: 8px;
    }

    /* Search Bar */
    .search-wrapper {
      display: flex; align-items: center; gap: 8px;
      background: rgba(0,0,0,0.2); padding: 4px 8px;
      border-radius: 50px; border: 1px solid var(--border);
    }
    .search-input {
      background: transparent; border: none; color: var(--text);
      font-family: 'Inter', sans-serif; width: 120px; outline: none; font-size: 14px;
    }
    .search-btn {
      background: var(--accent); color: white; border: none;
      border-radius: 50%; width: 28px; height: 28px;
      display: grid; place-items: center; cursor: pointer;
    }

    /* MAIN LAYOUT GRID */
    .container {
      width: min(1180px, 96vw); margin: 0 auto; padding: 20px;
      display: grid;
      grid-template-columns: minmax(0, 1.35fr) minmax(320px, 0.95fr); /* Timeline | Sticky Sidebar */
      gap: 28px;
    }
    
    /* Hero Section (Spans full width) */
    .hero { grid-column: 1 / -1; text-align: center; margin: 40px 0 20px; }
    .pill { background: var(--panel-strong); padding: 6px 14px; border-radius: 999px; font-size: 0.85rem; color: var(--muted); border: 1px solid var(--border); display: inline-block; margin-bottom: 12px;}
    .hero-actions { display: flex; justify-content: center; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    .cta-btn {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
      color: #fff; border: none; border-radius: 999px; padding: 12px 18px;
      font-weight: 700; cursor: pointer; box-shadow: var(--shadow);
      letter-spacing: 0.01em; transition: var(--transition);
    }
    .cta-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.35); }
    .cta-btn:active { transform: translateY(0); box-shadow: var(--shadow); }

    /* Current News Section */
    .news-section {
      width: min(1180px, 96vw);
      margin: 14px auto 6px;
      padding: 14px 16px 16px;
      background: rgba(26, 29, 35, 0.92);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .news-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .news-header-row h2 {
      font-size: 1.2rem;
      margin: 0;
      letter-spacing: 0.01em;
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    .news-subtitle {
      font-size: 0.85rem;
      color: var(--muted);
      font-weight: 600;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }
    .news-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.85rem;
      color: var(--muted);
    }
    .news-refresh-btn {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 7px 12px;
      font-weight: 800;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 6px 16px rgba(0,0,0,0.35);
    }
    .news-refresh-btn:hover { transform: translateY(-1px); }
    .news-filters {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .news-checkboxes {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 0.9rem;
      color: var(--text);
    }
    .news-checkboxes label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      cursor: pointer;
      user-select: none;
      font-weight: 700;
      transition: var(--transition);
    }
    .news-checkboxes label:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }
    .news-search-input {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 8px 12px;
      color: var(--text);
      font-size: 0.9rem;
      min-width: 220px;
      outline: none;
    }
    .news-search-input:focus { border-color: var(--accent); }
    .news-status {
      color: var(--muted);
      font-size: 0.95rem;
      padding: 6px 2px 10px;
    }
    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(270px, 1fr));
      gap: 14px;
    }
    .news-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px 15px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: var(--transition);
      box-shadow: 0 4px 16px rgba(0,0,0,0.25);
    }
    .news-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.38);
    }
    .news-title {
      font-weight: 800;
      font-size: 1.02rem;
      line-height: 1.35;
      color: var(--text);
      text-decoration: none;
    }
    .news-title:hover { color: var(--accent); }
    .news-meta {
      font-size: 0.8rem;
      color: var(--muted);
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }
    .news-source-pill {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      font-weight: 700;
      color: var(--text);
      font-size: 0.72rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }
    .news-snippet {
      font-size: 0.9rem;
      color: var(--text);
      opacity: 0.9;
      line-height: 1.45;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .news-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 2px;
    }
    .news-tag {
      font-size: 0.7rem;
      font-weight: 800;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(79, 156, 255, 0.12);
      color: var(--accent);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }
    .news-tag.battery { background: rgba(0, 212, 170, 0.12); color: var(--accent-2); }
    .news-tag.robotics { background: rgba(255, 107, 157, 0.12); color: var(--accent-3); }
    .news-tag.bci { background: rgba(255, 179, 71, 0.14); color: var(--forecast); }

    /* TIMELINE COLUMN */
    .timeline-column { position: relative; }

    /* The Center Spine (Centered within the Left Column) */
    .timeline-feed { position: relative; padding: 20px 0; }
    
    .timeline-feed::before {
      content: ''; position: absolute; top: 0; bottom: 0; left: 50%;
      width: 2px; background: linear-gradient(180deg, var(--accent) 0%, rgba(255,255,255,0.05) 100%);
      transform: translateX(-50%);
    }

    .timeline-card {
      position: relative; width: 48%; margin-bottom: 44px;
      background: var(--panel); border: 1px solid var(--border);
      border-radius: 16px; padding: 20px;
      cursor: pointer; transition: var(--transition);
      transform-origin: center;
      opacity: 0.92;
    }

    /* Active State (Triggered by Scroll) */
    .timeline-card.active-card {
      border-color: var(--accent);
      box-shadow: 0 0 25px rgba(79, 156, 255, 0.2);
      background: var(--panel-strong);
      transform: translateY(-2px);
    }

    .timeline-card.selected-badge::before {
      content: 'Selected';
      position: absolute;
      top: 14px; right: 14px;
      background: rgba(79, 156, 255, 0.12);
      color: var(--accent);
      border: 1px solid rgba(79, 156, 255, 0.35);
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.7rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      font-weight: 700;
    }
    /* Place "Selected" badge top-left for left-side cards (even items) */
    .timeline-card:nth-child(even).selected-badge::before {
      left: 14px;
      right: auto;
    }

    .timeline-card.dimmed { opacity: 0.55; filter: saturate(0.8); }

    /* Alternating Sides */
    .timeline-card:nth-child(odd) { margin-left: auto; margin-right: 0; text-align: left; }
    .timeline-card:nth-child(even) { margin-left: 0; margin-right: auto; text-align: right; }

    /* Center Dots */
    .timeline-dot {
      position: absolute; top: 24px; width: 14px; height: 14px;
      border-radius: 50%; background: var(--bg); border: 3px solid var(--accent);
      z-index: 2; transition: var(--transition);
    }
    .timeline-card:nth-child(odd) .timeline-dot { left: -11.5%; } 
    .timeline-card:nth-child(even) .timeline-dot { right: -11.5%; }
    
    /* Adjust dots based on card width/gap calculation approximately */
    @media (min-width: 900px) {
       .timeline-card:nth-child(odd) .timeline-dot { left: calc(-11% - 3px); } 
       .timeline-card:nth-child(even) .timeline-dot { right: calc(-11% - 3px); } 
    }

    /* Connector Lines */
    .timeline-card::after {
      content: ''; position: absolute; top: 31px; height: 1px; width: 11%;
      background: var(--border); opacity: 0.5; z-index: 1;
    }
    .timeline-card:nth-child(odd)::after { left: -11%; }
    .timeline-card:nth-child(even)::after { right: -11%; }

    /* Content Styling */
    .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .timeline-card:nth-child(even) .card-header { flex-direction: row-reverse; }

    .card-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .timeline-card:nth-child(even) .card-meta { justify-content: flex-end; }

    .timeline-year {
      font-weight: 700; color: var(--accent); text-transform: uppercase;
      font-size: 0.85rem; letter-spacing: 1px; flex-shrink: 0;
    }
    .visual-icon { font-size: 1.5rem; }
    
    .analysis-btn {
      font-size: 0.85rem; color: #fff; margin-top: 10px;
      display: inline-flex; align-items: center; gap: 8px;
      font-weight: 700; padding: 8px 14px;
      border-radius: 999px; border: none; cursor: pointer;
      background: linear-gradient(135deg, var(--accent-3) 0%, var(--accent) 100%);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    .analysis-btn:hover { transform: translateY(-1px); }
    .analysis-btn:active { transform: translateY(0); box-shadow: 0 6px 14px rgba(0,0,0,0.35); }

    /* Expanded Content */
    .extended-content {
      max-height: 0; opacity: 0; overflow: hidden;
      transition: var(--transition);
      margin-top: 0; border-top: 1px solid transparent; text-align: left;
    }
    .timeline-card:nth-child(even) .extended-content { text-align: right; }

    .timeline-card.expanded .extended-content {
      max-height: 800px; opacity: 1; margin-top: 16px;
      padding-top: 16px; border-top-color: var(--border);
    }
    .timeline-card.expanded .expand-hint { display: none; }

    /* STICKY SIDEBAR COLUMN */
    .sidebar-column { position: relative; }
    
    .floating-panel {
      position: sticky; top: 100px;
      background: var(--panel-strong);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: var(--shadow);
      text-align: left;
      transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
      opacity: 0; transform: translateY(20px);
    }
    .floating-panel.visible { opacity: 1; transform: translateY(0); }


    
    .fp-emoji {
      font-size: 2.5rem; margin: 0 0 16px 0;
    }

    .fp-stock-box {
      background: rgba(0, 212, 170, 0.08);
      border: 1px solid var(--accent-2);
      border-radius: 12px; padding: 12px;
      margin-top: 12px; text-align: left;
    }
    .fp-stock-label { font-size: 0.75rem; text-transform: uppercase; color: var(--accent-2); font-weight: 700; display: block; margin-bottom: 4px; }
    .fp-stock-text { font-size: 0.9rem; line-height: 1.4; }

    /* Style for the Wiki Button */
    .wiki-btn {
      display: inline-block; margin-top: 12px;
      padding: 8px 16px; background: var(--accent); color: white;
      border-radius: 6px; font-size: 0.85rem; font-weight: 600;
      transition: opacity 0.2s;
    }
    .wiki-btn:hover { opacity: 0.9; }
    .news-btn {
      display: inline-block; margin-top: 8px; margin-left: 8px;
      padding: 8px 16px; background: var(--accent-2); color: white;
      border-radius: 6px; font-size: 0.85rem; font-weight: 600;
      transition: opacity 0.2s;
    }
    .news-btn:hover { opacity: 0.9; }

    /* Style for the Product Tags */
    .product-tag {
      display: inline-block; padding: 4px 8px;
      background: rgba(255,255,255,0.1); border-radius: 4px;
      font-size: 0.75rem; margin-right: 6px; margin-top: 6px;
      border: 1px solid var(--border);
    }

    .forecast-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(255, 179, 71, 0.14);
      border: 1px solid rgba(255, 179, 71, 0.4);
      color: var(--forecast);
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .forecast-note {
      margin: 12px 0 0;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255, 179, 71, 0.12);
      border: 1px solid rgba(255, 179, 71, 0.35);
      color: var(--forecast);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* MOBILE RESPONSIVE */
    @media (max-width: 900px) {
      .container { grid-template-columns: 1fr; gap: 0; padding: 10px; }
      
      /* Sidebar becomes Bottom Drawer */
      .sidebar-column {
        position: fixed; bottom: 0; left: 0; right: 0;
        z-index: 100; pointer-events: none;
        padding: 10px;
      }
      .floating-panel {
        pointer-events: auto;
        text-align: left; padding: 12px;
        background: rgba(26, 29, 35, 0.98);
        border: 1px solid var(--accent);
        box-shadow: 0 -4px 30px rgba(0,0,0,0.5);
        margin: 0; top: auto;
        max-height: 65vh;
        overflow-y: auto;
        transform: translateY(0);
      }
      .floating-panel.collapsed {
        transform: translateY(calc(100% - 56px));
        box-shadow: 0 -2px 18px rgba(0,0,0,0.35);
        border-color: var(--border);
      }
      .drawer-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 10px 12px;
        margin: -12px -12px 12px -12px;
        background: rgba(255,255,255,0.04);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 2;
      }
      .drawer-toggle button {
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 999px;
        padding: 6px 12px;
        font-weight: 700;
        cursor: pointer;
      }
      .drawer-label {
        font-weight: 700;
        letter-spacing: 0.02em;
      }
      .fp-stock-box { background: transparent; border: none; padding: 0; margin: 0; }
      .fp-stock-label { display: inline; margin-right: 6px; }
      .fp-stock-text { font-size: 0.85rem; display: inline; }

      /* Timeline Adjustments */
      .timeline-feed::before { left: 20px; transform: none; }
      .timeline-card { 
        width: calc(100% - 50px); 
        margin-left: 50px !important; margin-right: 0 !important; 
        text-align: left !important;
      }
      .timeline-card:nth-child(even) .card-header { flex-direction: row; }
      .timeline-card:nth-child(even) .extended-content { text-align: left; }

      /* On mobile, all cards are left-aligned: keep badge top-left */
      .timeline-card.selected-badge::before {
        left: 14px;
        right: auto;
      }
      
      .timeline-dot { left: -38px !important; right: auto !important; }
      .timeline-card::after { left: -30px !important; right: auto !important; width: 30px; }
    }
  </style>
</head>
<body data-timeline-path="https://raw.githubusercontent.com/alphaonlines/AlphaAI/main/timeline.json">

  <header>
    <div class="nav">
      <div class="brand">
        <span class="dot"></span>
        <span id="titleText">AlphaAI v3.2 Timeline</span>
        <span class="last-updated" id="lastUpdatedDate">Updated: Today</span>
      </div>
      
       <div class="search-wrapper">
         <input type="text" class="search-input" placeholder="Search timeline...">
         <button class="search-btn" onclick="playHistory()">â–¶</button>
       </div>
    </div>
  </header>

  <section class="news-section" id="currentNews">
    <div class="news-header-row">
      <h2>Todayâ€™s Tech News <span class="news-subtitle">Last 7 Days</span></h2>
      <div class="news-controls">
        <button type="button" class="news-refresh-btn" id="newsRefreshBtn">Refresh</button>
        <span id="newsLastUpdated">Last updated: â€”</span>
      </div>
    </div>
    <div class="news-filters">
      <div class="news-checkboxes" id="newsCategoryFilters">
        <label><input type="checkbox" value="AI"> AI</label>
        <label><input type="checkbox" value="Batteries"> Batteries</label>
        <label><input type="checkbox" value="Robotics"> Robotics</label>
        <label><input type="checkbox" value="BCI"> BCI</label>
      </div>
      <input id="newsSearchInput" class="news-search-input" type="text" placeholder="Search news...">
    </div>
    <div id="newsStatus" class="news-status">Loading current tech newsâ€¦</div>
    <div id="newsGrid" class="news-grid"></div>
  </section>

  <div class="container">
    <section class="hero">
      <div class="pill">-3500 â€“ 2026</div>
      <h1>Innovation Timeline</h1>
      <p style="color: var(--muted); margin-top: 8px;">
        From the Voltaic Pile to Agentic AI.
      </p>
      <div class="hero-actions">
        <button type="button" class="cta-btn" onclick="scrollToBeginning()">Start from the beginning</button>
      </div>
    </section>

    <div class="timeline-column">
      <div class="timeline-feed" id="timelineFeed">
        </div>
    </div>

    <div class="sidebar-column">
      <aside class="floating-panel" id="floatingPanel">
        <div class="drawer-toggle" id="drawerToggle">
          <span class="drawer-label">Milestone details</span>
          <button type="button" id="drawerToggleBtn">Expand</button>
        </div>
        <div class="fp-content">
          <div class="fp-emoji" id="fpEmoji">ðŸš€</div>
          <h3 id="fpTitle" style="font-size: 1.4rem; margin-bottom: 8px;">Select an Era</h3>
          <p id="fpSummary" style="color: var(--muted); font-size: 0.95rem; margin-bottom: 16px;">
            Scroll through history to see market impacts.
          </p>
          <div id="fpForecast" class="forecast-note" style="display:none;">Forecast / speculative entry. Details may evolve.</div>

          <div class="fp-stock-box">
            <span class="fp-stock-label">ðŸ“ˆ Market Analysis</span>
            <span class="fp-stock-text" id="fpStock">Waiting for data...</span>
          </div>

          <div id="fpNewsContainer" style="margin-top: 12px; display:none;">
            <a id="fpNewsLink" href="#" target="_blank" class="news-btn">ðŸ“° Read news report</a>
          </div>

          <div id="fpProducts" style="margin-top: 16px;"></div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Sticky sidebar element references
    const floatingPanel = document.getElementById('floatingPanel');
    const fpTitle = document.getElementById('fpTitle');
    const fpStock = document.getElementById('fpStock');
    const fpEmoji = document.getElementById('fpEmoji');
    const fpSummary = document.getElementById('fpSummary');
    const fpProducts = document.getElementById('fpProducts');
    const fpNewsContainer = document.getElementById('fpNewsContainer');
    const fpNewsLink = document.getElementById('fpNewsLink');
    const drawerToggle = document.getElementById('drawerToggle');
    const drawerToggleBtn = document.getElementById('drawerToggleBtn');
    let drawerOpen = false;

    const isMobileLayout = () => window.matchMedia('(max-width: 900px)').matches;

    function collapseDrawer() {
      if (!isMobileLayout()) return;
      floatingPanel.classList.add('collapsed');
      drawerOpen = false;
      drawerToggleBtn.textContent = 'Expand';
    }

    function expandDrawer() {
      if (!isMobileLayout()) return;
      floatingPanel.classList.remove('collapsed');
      drawerOpen = true;
      drawerToggleBtn.textContent = 'Hide';
    }

    function populateFloatingPanel(data = {}) {
      floatingPanel.classList.add('visible');

      fpTitle.textContent = data.title || 'Select an Era';
      fpEmoji.textContent = data.visual || 'ðŸ›°ï¸';

      fpStock.textContent = data.market_analysis || data.stockReaction || data.summary || 'Waiting for data...';
      fpSummary.textContent = data.summary || 'Scroll through history to see market impacts.';

      if (data.news_url) {
        fpNewsLink.href = data.news_url;
        fpNewsContainer.style.display = 'block';
      } else {
        fpNewsContainer.style.display = 'none';
        fpNewsLink.href = '#';
      }

      const forecastBanner = document.getElementById('fpForecast');
      if (data.isForecast) {
        forecastBanner.style.display = 'block';
      } else {
        forecastBanner.style.display = 'none';
      }

      fpProducts.innerHTML = '';
      if (data.products && Array.isArray(data.products)) {
        data.products.forEach(prod => {
          const tag = document.createElement('span');
          tag.className = 'product-tag';
          tag.textContent = prod;
          fpProducts.appendChild(tag);
        });
      }
    }

    function setActiveCard(card) {
      if (!card) return;

      document.querySelectorAll('.timeline-card').forEach(c => {
        c.classList.remove('active-card', 'selected-badge');
        c.classList.add('dimmed');
      });
      card.classList.add('active-card', 'selected-badge');
      card.classList.remove('dimmed');

      const data = JSON.parse(card.dataset.info || '{}');
      populateFloatingPanel(data);
    }

    function toggleCardExpansion(card) {
      const isExpanded = card.classList.contains('expanded');
      document.querySelectorAll('.timeline-card').forEach(c => c.classList.remove('expanded'));
      if(!isExpanded) card.classList.add('expanded');
    }

    // Drawer interactions for mobile
    drawerToggle.addEventListener('click', (e) => {
      if (!isMobileLayout()) return;
      e.stopPropagation();
      drawerOpen ? collapseDrawer() : expandDrawer();
    });

    window.addEventListener('resize', () => {
      if (isMobileLayout()) {
        collapseDrawer();
      } else {
        floatingPanel.classList.remove('collapsed');
        drawerToggleBtn.textContent = 'Hide';
        drawerOpen = true;
      }
    });

    window.addEventListener('scroll', () => {
      if (isMobileLayout() && drawerOpen) {
        collapseDrawer();
      }
    }, { passive: true });

    // --- CONFIGURATION ---
    const lastUpdated = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    document.getElementById('lastUpdatedDate').textContent = `Updated: ${lastUpdated}`;
    const currentYear = new Date().getFullYear();

    // --- SEARCH FUNCTIONALITY ---
    const searchInput = document.querySelector('.search-input');
    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      const cards = document.querySelectorAll('.timeline-card');

      cards.forEach(card => {
        // Search in title, summary, and year
        const info = JSON.parse(card.dataset.info);
        const textContent = `${info.title} ${info.summary} ${info.year}`.toLowerCase();

        if (textContent.includes(term)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });

    // --- FETCH DATA & INIT ---
    const monthOrder = {
      'jan': 1, 'feb': 2, 'mar': 3, 'apr': 4, 'may': 5, 'jun': 6,
      'jul': 7, 'aug': 8, 'sep': 9, 'oct': 10, 'nov': 11, 'dec': 12,
      'early': 3, 'mid': 6, 'late': 9
    };

    // --- CURRENT NEWS (GDELT Doc 2.0) ---
    const NEWS_QUERY =
      '(AI OR "artificial intelligence" OR LLM OR robotics OR humanoid OR "brain-computer interface" OR BCI OR Neuralink OR battery OR "energy storage" OR BESS OR "solid-state") sourcelang:English';

    const CATEGORY_QUERIES = {
      AI: '(AI OR "artificial intelligence" OR LLM OR GPT OR transformer OR "foundation model" OR "agentic AI") sourcelang:English',
      Batteries: '(battery OR batteries OR BESS OR "energy storage" OR "solid-state" OR lithium OR LFP OR sodium-ion OR "grid storage" OR "battery energy storage system" OR cathode OR anode) sourcelang:English',
      Robotics: '(robotics OR robot OR humanoid OR "humanoid robot" OR automation OR robotaxi OR "autonomous vehicle" OR drone OR eVTOL OR "air taxi" OR "delivery robot") sourcelang:English',
      BCI: '("brain-computer interface" OR BCI OR Neuralink OR "neural link" OR "neuralink" OR "brain interface" OR "brain implant" OR "neural implant" OR stentrode OR Paradromics OR Synchron OR "Blackrock Neurotech" OR "Precision Neuroscience" OR BrainGate OR "MindMaze" OR Kernel OR Neurable OR NextMind OR Emotiv OR OpenBCI) sourcelang:English'
    };

    const CATEGORY_CONFIG = [
      { name: 'AI', query: CATEGORY_QUERIES.AI, days: 7, perCategory: 10 },
      { name: 'Batteries', query: CATEGORY_QUERIES.Batteries, days: 14, perCategory: 12 },
      { name: 'Robotics', query: CATEGORY_QUERIES.Robotics, days: 14, perCategory: 12 },
      { name: 'BCI', query: CATEGORY_QUERIES.BCI, days: 14, perCategory: 12 }
    ];

    const NEWS_CATEGORIES = {
      AI: /\b(ai|artificial intelligence|llm|gpt|transformer|openai|anthropic|deepmind|agentic)\b/i,
      Batteries: /\b(battery|bess|energy storage|solid-state|lithium|lfp|grid storage|megapack)\b/i,
      Robotics: /\b(robot|robotics|humanoid|automation|robotaxi|drone|evtol|air taxi|autonomous vehicle)\b/i,
      BCI: /\b(brain[-\s]?computer interface|bci|neural\s?link|neuralink|brain\s?interface|brain\s?implant|neurotech|neuroprosthetic|neural\s+implant|stentrode|paradromics|synchron|blackrock\s+neurotech|kernel|mind\s?control|eeg|ecog|neural\s+decoding)\b/i
    };

    let newsArticles = [];

    function pad2(n) { return String(n).padStart(2, '0'); }
    function toGdeltDatetime(d) {
      return (
        d.getUTCFullYear() +
        pad2(d.getUTCMonth() + 1) +
        pad2(d.getUTCDate()) +
        pad2(d.getUTCHours()) +
        pad2(d.getUTCMinutes()) +
        pad2(d.getUTCSeconds())
      );
    }

    function detectCategories(text) {
      const tags = [];
      const hay = (text || '').toLowerCase();
      for (const [name, re] of Object.entries(NEWS_CATEGORIES)) {
        if (re.test(hay)) tags.push(name);
      }
      return tags.length ? tags : ['AI']; // default to AI if unclear
    }

    function canonicalTitle(title) {
      let t = (title || '').toLowerCase();
      // Strip common source suffixes like " - Reuters" or "| The Verge"
      t = t.replace(/\s+[-|]\s+[a-z0-9 .:&'-]{2,}$/i, '');
      t = t.replace(/[^a-z0-9]+/g, ' ').trim();
      // Remove very common filler words to improve cross-site matching
      const stop = new Set(['the','a','an','and','or','of','to','in','for','on','with','as','at','by','from','new','report','reports']);
      t = t.split(' ').filter(w => w && !stop.has(w)).join(' ');
      return t;
    }

    function dedupeByUrlAndTitle(items) {
      const seenUrl = new Set();
      const seenTitle = new Set();
      const out = [];
      for (const item of items) {
        const url = item.url;
        const titleKey = canonicalTitle(item.title);
        if (url && seenUrl.has(url)) continue;
        if (titleKey && seenTitle.has(titleKey)) continue;
        if (url) seenUrl.add(url);
        if (titleKey) seenTitle.add(titleKey);
        out.push(item);
      }
      return out;
    }

    function isLikelyEnglish(text) {
      const s = (text || '').trim();
      if (!s) return true;
      // Quick reject for common non-Latin scripts
      if (/[ä¸€-é¾¯ã-ã‚Ÿã‚ -ãƒ¿ã„±-ã…Žã…-ã…£\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/.test(s)) return false;
      const letters = s.match(/\p{L}/gu) || [];
      if (!letters.length) return true;
      const latin = (s.match(/[A-Za-z]/g) || []).length;
      return latin / letters.length > 0.6;
    }

    function normalizeGdeltArticle(a) {
      const url = a.url || '';
      let domain = a.sourceCommonName || a.domain || '';
      if (!domain && url) {
        try { domain = new URL(url).hostname.replace(/^www\./, ''); } catch {}
      }
      const dateStr = a.seendate || a.date || a.publishDate || '';
      const date = dateStr ? new Date(dateStr) : null;
      const snippet = (a.excerpt || a.snippet || a.summary || '').trim();
      const title = (a.title || '').trim();
      const tags = detectCategories(`${title} ${snippet}`);
      const lang = (a.language || a.sourceLanguage || a.sourcelang || '').toString();
      return { title, url, domain, date, snippet, tags, lang };
    }

    async function fetchGdeltForQuery(query, maxrecords, now, start) {
      const params = new URLSearchParams({
        query,
        mode: 'ArtList',
        format: 'json',
        maxrecords: String(maxrecords),
        sort: 'DateDesc',
        startdatetime: toGdeltDatetime(start),
        enddatetime: toGdeltDatetime(now)
      });
      const url = `https://api.gdeltproject.org/api/v2/doc/doc?${params.toString()}`;
      const resp = await fetch(url, { cache: 'no-store' });
      if (!resp.ok) throw new Error(`${resp.status} ${resp.statusText}`);
      const data = await resp.json();
      const raw = data.articles || [];
      return raw
        .map(normalizeGdeltArticle)
        .filter((a) => {
          const lang = (a.lang || '').toLowerCase();
          if (lang && !lang.startsWith('en') && !lang.includes('english')) return false;
          return isLikelyEnglish(`${a.title} ${a.snippet}`);
        });
    }

    async function fetchGdeltNewsBalanced() {
      const now = new Date();
      const results = await Promise.all(
        CATEGORY_CONFIG.map((cfg) => {
          const start = new Date(now);
          start.setDate(start.getDate() - cfg.days);
          return fetchGdeltForQuery(cfg.query, cfg.perCategory, now, start).catch(() => []);
        })
      );
      const merged = dedupeByUrlAndTitle(results.flat());
      merged.sort((a, b) => (b.date?.getTime() || 0) - (a.date?.getTime() || 0));
      return merged.slice(0, 25);
    }

    async function fetchNewsApiFallback() {
      const key =
        window.NEWSAPI_KEY ||
        localStorage.getItem('NEWSAPI_KEY') ||
        '';
      if (!key) return [];
      const now = new Date();
      const from = new Date(now);
      from.setDate(from.getDate() - 7);
      const params = new URLSearchParams({
        q: NEWS_QUERY,
        from: from.toISOString(),
        sortBy: 'publishedAt',
        pageSize: '25',
        language: 'en',
        apiKey: key
      });
      const url = `https://newsapi.org/v2/everything?${params.toString()}`;
      const resp = await fetch(url, { cache: 'no-store' });
      if (!resp.ok) throw new Error(`${resp.status} ${resp.statusText}`);
      const data = await resp.json();
      const raw = data.articles || [];
      return raw.map((a) => {
        const title = (a.title || '').trim();
        const url = a.url || '';
        let domain = '';
        if (a.source && a.source.name) domain = a.source.name;
        if (!domain && url) {
          try { domain = new URL(url).hostname.replace(/^www\./, ''); } catch {}
        }
        const date = a.publishedAt ? new Date(a.publishedAt) : null;
        const snippet = (a.description || '').trim();
        const tags = detectCategories(`${title} ${snippet}`);
        return { title, url, domain, date, snippet, tags };
      });
    }

    function renderNewsList(items) {
      const grid = document.getElementById('newsGrid');
      const status = document.getElementById('newsStatus');
      if (!grid || !status) return;
      if (!items.length) {
        status.textContent = 'No matching articles found.';
        grid.innerHTML = '';
        return;
      }
      status.textContent = '';
      grid.innerHTML = '';
      items.forEach((item) => {
        const card = document.createElement('article');
        card.className = 'news-card';
        const dateLabel = item.date
          ? item.date.toLocaleString()
          : '';
        const tagHtml = item.tags.map((t) => {
          const cls =
            t === 'Batteries' ? 'battery' :
            t === 'Robotics' ? 'robotics' :
            t === 'BCI' ? 'bci' : '';
          return `<span class="news-tag ${cls}">${t}</span>`;
        }).join('');
        card.innerHTML = `
          <a class="news-title" href="${item.url}" target="_blank" rel="noopener">${item.title}</a>
          <div class="news-meta">
            <span class="news-source-pill">${item.domain || 'Unknown'}</span>
            ${dateLabel ? `<span>â€¢ ${dateLabel}</span>` : ''}
          </div>
          ${item.snippet ? `<div class="news-snippet">${item.snippet}</div>` : ''}
          <div class="news-tags">${tagHtml}</div>
        `;
        grid.appendChild(card);
      });
    }

    function applyNewsFilters() {
      const searchVal = (document.getElementById('newsSearchInput')?.value || '').toLowerCase().trim();
      const checked = Array.from(document.querySelectorAll('#newsCategoryFilters input[type="checkbox"]'))
        .filter((c) => c.checked)
        .map((c) => c.value);
      const activeSet = new Set(checked);

      if (!activeSet.size) {
        renderNewsList([]);
        const status = document.getElementById('newsStatus');
        if (status) status.textContent = 'Select a category to see news.';
        return;
      }

      const filtered = newsArticles.filter((a) => {
        const matchText = !searchVal || `${a.title} ${a.snippet}`.toLowerCase().includes(searchVal);
        const matchCat = a.tags.some((t) => activeSet.has(t));
        return matchText && matchCat;
      });
      renderNewsList(filtered);
    }

    async function initNews() {
      const status = document.getElementById('newsStatus');
      const lastUpdated = document.getElementById('newsLastUpdated');
      const refreshBtn = document.getElementById('newsRefreshBtn');
      if (!status) return;

      async function load() {
        status.textContent = 'Loading current tech newsâ€¦';
        try {
          let items = await fetchGdeltNewsBalanced();
          // Newest first
          items.sort((a, b) => (b.date?.getTime() || 0) - (a.date?.getTime() || 0));
          newsArticles = items;
        } catch (e) {
          try {
            let items = await fetchNewsApiFallback();
            items = dedupeByUrlAndTitle(items);
            items.sort((a, b) => (b.date?.getTime() || 0) - (a.date?.getTime() || 0));
            newsArticles = items;
          } catch (fallbackErr) {
            newsArticles = [];
            status.textContent = 'Unable to load current news. Please try Refresh later.';
            console.error('News load failed:', e, fallbackErr);
          }
        }
        if (lastUpdated) {
          lastUpdated.textContent = `Last updated: ${new Date().toLocaleString()}`;
        }
        applyNewsFilters();
      }

      refreshBtn?.addEventListener('click', load);
      document.getElementById('newsSearchInput')?.addEventListener('input', applyNewsFilters);
      document.querySelectorAll('#newsCategoryFilters input[type="checkbox"]').forEach((c) => {
        c.addEventListener('change', applyNewsFilters);
      });

      await load();
    }

    function sortTimeline(data) {
      return data.slice().sort((a, b) => {
        if (b.year !== a.year) return b.year - a.year;
        const aMonth = monthOrder[(a.month || '').toLowerCase()] || 0;
        const bMonth = monthOrder[(b.month || '').toLowerCase()] || 0;
        return bMonth - aMonth;
      });
    }

    function normalizeTimelinePath(path) {
      if (!path) return path;
      // Auto-convert GitHub "blob" URLs to raw URLs.
      const blobMatch = path.match(/^https?:\/\/github\.com\/([^/]+)\/([^/]+)\/blob\/([^/]+)\/(.+)$/i);
      if (blobMatch) {
        const [, owner, repo, branch, filePath] = blobMatch;
        return `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${filePath}`;
      }
      return path;
    }

    async function fetchTimelineData() {
      const timelinePath = document.body.dataset.timelinePath || 'timeline.json';
      const isHttpUrl = (path) => /^https?:\/\//i.test(path);

      const toRawGitHub = (path) => {
        try {
          const url = new URL(path);
          const match = url.pathname.match(/^\/(.+?)\/(.+?)\/blob\/(.+)$/);

          if (url.hostname === 'github.com' && match) {
            return `https://raw.githubusercontent.com/${match[1]}/${match[2]}/${match[3]}`;
          }
        } catch (_) {
          return null;
        }
        return null;
      };

      const candidatePaths = [];
      const rawGitHub = isHttpUrl(timelinePath) ? toRawGitHub(timelinePath) : null;

      if (rawGitHub) candidatePaths.push(rawGitHub);
      candidatePaths.push(timelinePath);

      if (!isHttpUrl(timelinePath) && !timelinePath.includes('/')) {
        candidatePaths.push(`data/${timelinePath}`);
      }

      const errors = [];

      for (const path of candidatePaths) {
        const isAbsolute = isHttpUrl(path);
        const url = isAbsolute ? path : new URL(path, window.location.href).href;
        const fetchOptions = { cache: 'no-store' };

        if (isAbsolute) {
          fetchOptions.mode = 'cors';
          fetchOptions.credentials = 'omit';
        } else {
          fetchOptions.mode = window.location.protocol === 'file:' ? 'cors' : 'same-origin';
        }

        try {
          const response = await fetch(url, fetchOptions);
          if (!response.ok) throw new Error(`${response.status} ${response.statusText}`);

          return await response.json();
        } catch (err) {
          errors.push(`${path} (${err.message})`);
        }
      }

      throw new Error(`Failed to load timeline data from: ${errors.join('; ')}`);
    }

    async function initTimeline() {
      const container = document.getElementById('timelineFeed');

      try {
        const timeline = await fetchTimelineData();
        const sortedTimeline = sortTimeline(timeline);

        if (!sortedTimeline.length) {
          throw new Error('Timeline data loaded but contained no entries.');
        }

        renderTimeline(sortedTimeline);
      } catch (err) {
        console.error('Timeline load failed:', err);

        const isFileProtocol = window.location.protocol === 'file:';
        container.innerHTML = `
          <div style="text-align:center; padding:40px; max-width:680px; margin:0 auto;">
            <h3>Unable to load timeline data.</h3>
            <p>You can set <code>data-timeline-path</code> on the <code>&lt;body&gt;</code> tag to point to a different JSON URL (same origin or a CORS-enabled absolute URL, e.g., <code>data/timeline.json</code> or a raw GitHub URL).</p>
            <p style="color:var(--muted); font-size:0.9rem;">Error: ${err.message}</p>
          </div>
        `;

        if (isFileProtocol) {
          const input = document.getElementById('timelineFileInput');
          const errorEl = document.getElementById('timelineFileError');
          if (input) {
            input.addEventListener('change', async (e) => {
              const file = e.target.files && e.target.files[0];
              if (!file) return;
              try {
                const text = await file.text();
                const data = JSON.parse(text);
                const sortedTimeline = sortTimeline(data);
                renderTimeline(sortedTimeline);
                errorEl.style.display = 'none';
              } catch (readErr) {
                errorEl.textContent = `Failed to read JSON: ${readErr.message}`;
                errorEl.style.display = 'block';
              }
            });
          }
        }
      }
    }

    // --- RENDER TIMELINE (Modified to accept data argument) ---
    function renderTimeline(data) {
      const container = document.getElementById('timelineFeed');
      container.innerHTML = ''; // Clear loading state

      data.forEach((item, index) => {
        const isForecast = Number(item.year) > currentYear;
        const cardPayload = { ...item, isForecast };
        const card = document.createElement('article');
        card.className = 'timeline-card';
        card.id = `card-${item.year}-${index}`;
        card.dataset.year = item.year;
        card.dataset.index = index;

        // Note: We use JSON.stringify for data passing to keep the logic clean
        card.dataset.info = JSON.stringify(cardPayload);

        card.innerHTML = `
          <div class="timeline-dot"></div>
          <div class="card-header">
            <span class="visual-icon">${item.visual}</span>
            <div>
              <div class="card-meta">
                <span class="timeline-year">${item.month ? item.month + ' ' : ''}${item.year}</span>
                ${isForecast ? '<span class="forecast-pill">Forecast</span>' : ''}
              </div>
              <h3 style="font-size:1.1rem;">${item.title}</h3>
            </div>
          </div>

          <p>${item.summary}</p>
          <button type="button" class="analysis-btn">ðŸ“Š View market analysis</button>

          <div class="extended-content">
            <div style="padding-left:12px; border-left:2px solid var(--accent); margin-bottom:12px; color: var(--text);">
              <strong>Why it matters:</strong> ${item.why || "Historical significance."}
            </div>

            ${item.wiki_url ? `<a href="${item.wiki_url}" target="_blank" class="wiki-btn">ðŸ“– Read on Wikipedia</a>` : ''}
            ${item.news_url ? `<a href="${item.news_url}" target="_blank" rel="noopener" class="news-btn">ðŸ“° Read news report</a>` : ''}
          </div>
        `;

        // Click to toggle expansion
        card.addEventListener('click', (e) => {
          if(e.target.tagName === 'A' || e.target.closest('.analysis-btn')) return;
          setActiveCard(card);
          toggleCardExpansion(card);
        });

        const analysisButton = card.querySelector('.analysis-btn');
        analysisButton.addEventListener('click', (event) => {
          event.stopPropagation();
          setActiveCard(card);
          toggleCardExpansion(card);
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

      container.appendChild(card);
      });

      setupObserver(data);

      // NEW: Auto-select the first card to populate the sidebar immediately
      if (document.querySelector('.timeline-card')) {
          setActiveCard(document.querySelector('.timeline-card'));
      }
    }

    // --- STICKY PANEL LOGIC (Modified to read from dataset) ---
    function setupObserver(timelineData) {
      const cards = document.querySelectorAll('.timeline-card');

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            setActiveCard(entry.target);
          }
        });
      }, {
        threshold: 0.5,
        rootMargin: "-10% 0px -10% 0px"
      });

      cards.forEach(card => observer.observe(card));
    }

    // --- JUMP TO YEAR ---
    function jumpToYear() {
      const input = document.getElementById('yearInput').value;
      if (!input) return;
      const targetYear = parseInt(input);
      const cards = Array.from(document.querySelectorAll('.timeline-card'));
      
      const targetCard = cards.reduce((prev, curr) => {
        return (Math.abs(curr.dataset.year - targetYear) < Math.abs(prev.dataset.year - targetYear) ? curr : prev);
      });

      if (targetCard) {
        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        targetCard.click(); 
        targetCard.style.transition = '0.2s';
        targetCard.style.background = 'var(--accent)';
        setTimeout(() => {
          targetCard.style.background = '';
          targetCard.style.transition = 'var(--transition)';
        }, 400);
      }
    }

    // --- JUMP TO OLDEST ---
    function scrollToBeginning() {
      const cards = document.querySelectorAll('.timeline-card');
      if (!cards.length) return;

      const oldestCard = cards[cards.length - 1];
      oldestCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
      if (!oldestCard.classList.contains('expanded')) {
        oldestCard.click();
      }
      oldestCard.style.transition = '0.3s';
      oldestCard.style.borderColor = 'var(--accent)';
      setTimeout(() => {
        oldestCard.style.borderColor = '';
      }, 1200);
    }

    // --- AUTOMATED TOUR ---
    function playHistory() {
      // 1. Get all timeline cards from the DOM
      const cards = Array.from(document.querySelectorAll('.timeline-card'));
      
      // 2. The DOM is sorted Newest(top) -> Oldest(bottom).
      //    Reverse it to get Chronological order (-3500 -> 2026).
      const chronologicalCards = cards.reverse();

      // 3. Select only the first 10 events
      const tourSteps = chronologicalCards.slice(0, 10);

      // 4. Iterate and schedule the scrolls
      tourSteps.forEach((card, index) => {
        setTimeout(() => {
          // Scroll the card into the center of the view
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Simulate a click to expand the details (optional)
          if (!card.classList.contains('expanded')) {
            card.click();
          }
          
          // Visual feedback: Flash the card using the accent color
          card.style.transition = '0.3s';
          card.style.borderColor = 'var(--accent)';
          card.style.boxShadow = '0 0 20px var(--accent)';
          
          // Remove the highlight after 1.5 seconds
          setTimeout(() => {
            card.style.borderColor = '';
            card.style.boxShadow = '';
          }, 1500);

        }, index * 4000); // 4000ms = 4 seconds per event
      });
    }

    // Start
    document.addEventListener('DOMContentLoaded', () => {
      if (isMobileLayout()) {
        collapseDrawer();
      } else {
        drawerOpen = true;
        drawerToggleBtn.textContent = 'Hide';
      }
      initNews();
      initTimeline();
    });
</script>
</body>
</html>
